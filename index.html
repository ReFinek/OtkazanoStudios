<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otkazano Studios</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#080808;color:#e0e0e0;font-family:Arial;min-height:100vh;overflow-x:hidden;position:relative}
        .textured-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:url('bg.png') repeat;background-size:300px 300px;opacity:0.15;z-index:-3;animation:bg-scroll 120s linear infinite}
        .bg-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,rgba(8,8,8,0.7) 0%,rgba(8,8,8,0.9) 100%);z-index:-2}
        .vector-bg{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-1;opacity:0.1;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.05),transparent 60%)}
        .vector-line{position:absolute;background:linear-gradient(90deg,transparent,#fff,transparent);animation:float 25s linear infinite}
        .line-1{top:20%;left:-150px;width:300px;height:1px;animation-delay:0}
        .line-2{top:60%;right:-150px;width:400px;height:1px;animation-delay:5s;animation-direction:reverse}
        .line-3{bottom:30%;left:-200px;width:250px;height:1px;animation-delay:10s}
        nav{background:linear-gradient(135deg,rgba(17,17,17,0.9),rgba(26,26,26,0.9));padding:15px 0;border-bottom:1px solid #222;box-shadow:0 0 25px rgba(0,0,0,0.8);position:fixed;top:0;left:0;width:100%;z-index:1000;backdrop-filter:blur(10px)}
        .nav-container{max-width:1200px;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px;flex-wrap:wrap}
        .nav-main-buttons{display:flex;gap:20px}
        .nav-button{background:linear-gradient(145deg,rgba(26,26,26,0.8),rgba(20,20,20,0.8));border:1px solid #2a2a2a;color:#bbb;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:14px;letter-spacing:1px;text-transform:uppercase;transition:all .3s ease;backdrop-filter:blur(5px)}
        .nav-button:hover{background:linear-gradient(145deg,rgba(37,37,37,0.9),rgba(24,24,24,0.9));border-color:#444;color:#fff;box-shadow:0 4px 18px rgba(255,255,255,0.05);transform:translateY(-2px)}
        .login-button{background:linear-gradient(145deg,rgba(42,26,26,0.8),rgba(26,20,20,0.8));border:1px solid #3a2a2a;margin-left:40px}
        .user-container{display:flex;align-items:center;margin-left:40px}
        .user-profile{display:flex;align-items:center;gap:10px;cursor:pointer;padding:5px 10px;border-radius:8px;transition:all .3s ease}
        .user-profile:hover{background:rgba(255,255,255,0.05)}
        .user-avatar{width:40px;height:40px;border-radius:50%;border:2px solid #555;overflow:hidden;background:#333}
        .user-avatar img{width:100%;height:100%;object-fit:cover}
        .username{color:#fff;font-size:14px;font-weight:700}
        .admin-badge{background:linear-gradient(145deg,rgba(26,58,26,0.8),rgba(20,50,20,0.8));border:1px solid #2a5a2a;color:#8f8;padding:8px 16px;border-radius:8px;font-size:12px;text-transform:uppercase;letter-spacing:1px;margin-left:15px;box-shadow:0 0 15px rgba(0,255,0,0.3);animation:glow 2s ease-in-out infinite alternate;backdrop-filter:blur(5px)}
        .users-search-container{padding:10px;border-bottom:1px solid #333}
        .users-search-input{width:100%;padding:8px 12px;background:rgba(30,30,30,0.8);border:1px solid #444;border-radius:6px;color:#fff;font-size:12px}
        .users-search-input:focus{outline:none;border-color:#666}
        .users-list{max-height:300px;overflow-y:auto}
        .user-list-item{display:flex;align-items:center;padding:8px 12px;border-bottom:1px solid #222;transition:background .3s ease;cursor:pointer}
        .user-list-item:hover{background:rgba(255,255,255,0.05)}
        .user-list-avatar{width:32px;height:32px;border-radius:50%;margin-right:10px;border:1px solid #555;overflow:hidden;background:#333}
        .user-list-avatar img{width:100%;height:100%;object-fit:cover}
        .user-list-info{flex:1}
        .user-list-name{color:#fff;font-size:12px;font-weight:700}
        .user-list-email{color:#888;font-size:10px}
        .user-list-admin{background:rgba(0,255,0,0.1);border-left:2px solid #0f0}
        .user-list-admin-badge{background:#0f0;color:#000;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:5px}
        .users-stats{padding:10px;border-top:1px solid #333;background:rgba(0,0,0,0.3);font-size:11px;color:#888}
        .no-users,.users-loading{padding:20px;text-align:center;color:#888;font-size:12px}
        .dropdown{position:absolute;background:rgba(20,20,20,0.95);border:1px solid #333;border-radius:8px;top:60px;padding:8px 0;min-width:220px;box-shadow:0 6px 25px rgba(0,0,0,0.5);opacity:0;visibility:hidden;transform:translateY(-10px);transition:all .3s ease;backdrop-filter:blur(10px)}
        .dropdown.show{opacity:1;visibility:visible;transform:translateY(0)}
        .dropdown-item{display:block;color:#ccc;padding:10px 16px;font-size:13px;text-decoration:none;transition:all .2s ease}
        .dropdown-item:hover{background:#222;color:#fff}
        .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;justify-content:center;align-items:center;z-index:2000;opacity:0;visibility:hidden;transition:all .3s ease}
        .modal.show{opacity:1;visibility:visible}
        .modal-content{background:linear-gradient(145deg,rgba(26,26,26,0.9),rgba(20,20,20,0.9));border:1px solid #333;border-radius:12px;padding:30px;width:90%;max-width:450px;box-shadow:0 10px 40px rgba(0,0,0,0.7);position:relative;max-height:90vh;overflow-y:auto;backdrop-filter:blur(10px)}
        .modal-close{position:absolute;top:15px;right:20px;background:none;border:none;color:#888;font-size:24px;cursor:pointer;transition:color .3s ease}
        .modal-close:hover{color:#fff}
        .modal-title{text-align:center;margin-bottom:25px;font-size:24px;color:#fff;text-transform:uppercase;letter-spacing:2px}
        .form-group{margin-bottom:20px}
        .form-input{width:100%;padding:12px 15px;background:rgba(30,30,30,0.8);border:1px solid #444;border-radius:6px;color:#fff;font-size:14px;transition:all .3s ease}
        .form-input:focus{outline:none;border-color:#666;box-shadow:0 0 10px rgba(255,255,255,0.1)}
        .form-submit{width:100%;padding:12px;background:linear-gradient(145deg,rgba(42,26,26,0.8),rgba(26,20,20,0.8));border:1px solid #3a2a2a;border-radius:6px;color:#fff;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;transition:all .3s ease}
        .form-submit:hover{background:linear-gradient(145deg,rgba(53,37,37,0.9),rgba(37,24,24,0.9));transform:translateY(-2px)}
        .form-link{text-align:center;margin-top:20px;font-size:14px;color:#888}
        .form-link a{color:#aaa;text-decoration:none;transition:color .3s ease}
        .form-link a:hover{color:#fff;text-decoration:underline}
        .error-message,.success-message{font-size:12px;margin-top:5px;display:none}
        .error-message{color:#f44}
        .success-message{color:#4f4}
        .error-message.show,.success-message.show{display:block}
        .avatar-upload{text-align:center;margin-bottom:20px}
        .avatar-preview{width:120px;height:120px;border-radius:50%;border:3px solid #555;margin:0 auto 15px;overflow:hidden;background:#333}
        .avatar-preview img{width:100%;height:100%;object-fit:cover}
        .upload-button{background:linear-gradient(145deg,rgba(42,26,26,0.8),rgba(26,20,20,0.8));border:1px solid #3a2a2a;color:#fff;padding:10px 20px;border-radius:6px;cursor:pointer;transition:all .3s ease;display:inline-block}
        .upload-button:hover{background:linear-gradient(145deg,rgba(53,37,37,0.9),rgba(37,24,24,0.9))}
        .upload-input{display:none}
        .settings-section{margin-bottom:25px;padding-bottom:20px;border-bottom:1px solid #333}
        .settings-section:last-child{border-bottom:none}
        .settings-title{font-size:18px;color:#fff;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px}
        .logout-button{width:100%;padding:12px;background:linear-gradient(145deg,rgba(58,26,26,0.8),rgba(42,20,20,0.8));border:1px solid #5a2a2a;border-radius:6px;color:#fff;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;transition:all .3s ease;margin-top:10px}
        .logout-button:hover{background:linear-gradient(145deg,rgba(69,37,37,0.9),rgba(53,24,24,0.9))}
        .logo-container{position:relative;display:inline-block;width:450px;height:450px;filter:drop-shadow(0 0 40px rgba(255,255,255,0.25)) drop-shadow(0 0 80px rgba(255,255,255,0.15));margin-top:80px}
        .logo-static{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:450px;height:450px;z-index:1;opacity:0.95}
        .logo-static img{width:100%;height:100%;object-fit:contain}
        .logo-rotating{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:35%;height:35%;z-index:2;animation:rotate-slow 80s linear infinite}
        .logo-rotating img{width:100%;height:100%;object-fit:contain}
        header{text-align:center;padding:60px 0 30px}
        .glitch-frame{position:relative;max-width:900px;margin:40px auto;padding:30px;background:rgba(0,0,0,0.7);border:1px solid #333;border-radius:8px;overflow:hidden;box-shadow:0 0 20px rgba(255,255,255,0.1);backdrop-filter:blur(5px)}
        .glitch-frame::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,#fff,transparent);animation:scanline 3s linear infinite}
        .glitch-frame::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(rgba(255,255,255,0.03) 50%,rgba(0,0,0,0.03) 50%);background-size:100% 4px;z-index:-1;opacity:0.3}
        .glitch-title{font-size:28px;font-weight:700;text-align:center;margin-bottom:25px;color:#fff;text-transform:uppercase;letter-spacing:2px;text-shadow:0 0 10px rgba(255,255,255,0.5);position:relative}
        .glitch-title::before,.glitch-title::after{content:attr(data-text);position:absolute;top:0;left:0;width:100%;height:100%}
        .glitch-title::before{animation:glitch-1 5s infinite linear alternate-reverse;color:#f0f;z-index:-1}
        .glitch-title::after{animation:glitch-2 3s infinite linear alternate-reverse;color:#0ff;z-index:-2}
        .glitch-text{font-size:16px;line-height:1.6;color:#ccc;text-align:center}
        .team-container{display:flex;flex-direction:column;gap:20px;margin-top:30px}
        .team-member{display:flex;align-items:center;background:rgba(20,20,20,0.8);border:1px solid #333;border-radius:8px;padding:15px;transition:all .4s ease;cursor:pointer}
        .team-member:hover{background:rgba(30,30,30,0.9);border-color:#555;transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,0.5)}
        .member-avatar{width:70px;height:70px;border-radius:50%;background:#333;margin-right:20px;border:2px solid #555;flex-shrink:0;overflow:hidden}
        .member-avatar img{width:100%;height:100%;object-fit:cover}
        .member-info{flex:1}
        .member-name{font-size:20px;font-weight:700;color:#fff;margin-bottom:5px;transition:all .4s ease}
        .member-role{font-size:14px;color:#aaa;margin-bottom:10px;transition:all .4s ease}
        .member-description{font-size:14px;color:#888;line-height:1.5;max-height:0;opacity:0;overflow:hidden;transition:all .4s ease}
        .team-member.active .member-name{font-size:16px;margin-bottom:8px}
        .team-member.active .member-role{font-size:12px;margin-bottom:12px}
        .team-member.active .member-description{max-height:200px;opacity:1}
        .fun-text{text-align:center;margin-top:40px;font-size:16px;color:#888;font-style:italic}
        .scroll-to-top{position:fixed;bottom:30px;right:30px;width:50px;height:50px;background:linear-gradient(145deg,rgba(42,26,26,0.8),rgba(26,20,20,0.8));border:1px solid #3a2a2a;border-radius:50%;color:#fff;font-size:20px;cursor:pointer;display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:all .3s ease;z-index:999;box-shadow:0 4px 15px rgba(0,0,0,0.5);backdrop-filter:blur(5px)}
        .scroll-to-top.show{opacity:1;visibility:visible}
        .scroll-to-top:hover{background:linear-gradient(145deg,rgba(53,37,37,0.9),rgba(37,24,24,0.9));transform:translateY(-3px)}
        @keyframes bg-scroll{0%{background-position:0 0}100%{background-position:1000px 1000px}}
        @keyframes float{0%{transform:translateX(-150px) rotate(0)}100%{transform:translateX(calc(100vw + 150px)) rotate(360deg)}}
        @keyframes glow{from{box-shadow:0 0 15px rgba(0,255,0,0.3)}to{box-shadow:0 0 25px rgba(0,255,0,0.5)}}
        @keyframes rotate-slow{from{transform:translate(-50%,-50%) rotate(0)}to{transform:translate(-50%,-50%) rotate(360deg)}}
        @keyframes scanline{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
        @keyframes glitch-1{0%{transform:translate(0)}20%{transform:translate(-2px,2px)}40%{transform:translate(-2px,-2px)}60%{transform:translate(2px,2px)}80%{transform:translate(2px,-2px)}100%{transform:translate(0)}}
        @keyframes glitch-2{0%{transform:translate(0)}20%{transform:translate(2px,2px)}40%{transform:translate(2px,-2px)}60%{transform:translate(-2px,2px)}80%{transform:translate(-2px,-2px)}100%{transform:translate(0)}}
        @media (max-width:768px){.logo-container{width:300px;height:300px}.logo-static{width:300px;height:300px}.team-member{flex-direction:column;text-align:center}.member-avatar{margin-right:0;margin-bottom:15px}.nav-container{justify-content:space-between;padding:0 15px}.nav-main-buttons{gap:10px}.nav-button{padding:10px 15px;font-size:12px}.login-button{margin-left:20px}.user-container{margin-left:20px}.username{display:none}.admin-badge{font-size:10px;padding:6px 12px;margin-left:10px}.users-dropdown{width:280px!important;left:-100px!important}}
    </style>
</head>
<body>
    <div class="textured-bg"></div>
    <div class="bg-overlay"></div>
    <div class="vector-bg">
        <div class="vector-line line-1"></div>
        <div class="vector-line line-2"></div>
        <div class="vector-line line-3"></div>
    </div>

    <nav>
        <div class="nav-container">
            <div class="nav-main-buttons">
                <button class="nav-button">–û –Ω–∞—Å</button>
                <div style="position:relative">
                    <button class="nav-button" id="projects-btn">–ù–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã</button>
                    <div class="dropdown" id="projects-dropdown">
                        <a href="https://refinek.github.io/DownToTheInksSite/" class="dropdown-item" target="_blank">Bendy: Down To The Inks</a>
                    </div>
                </div>
                <button class="nav-button">–ü–æ—Å—Ç—ã</button>
            </div>

            <div id="admin-users-section" style="display:none;position:relative">
                <button class="nav-button" id="users-btn">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <div class="dropdown users-dropdown" id="users-dropdown" style="width:300px;max-height:400px;overflow-y:auto">
                    <div class="users-search-container">
                        <input type="text" id="users-search" class="users-search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫–∞–º...">
                    </div>
                    <div class="users-list" id="users-list"></div>
                    <div class="users-stats" id="users-stats"></div>
                </div>
            </div>

            <div id="auth-section">
                <button class="nav-button login-button" id="login-btn">–í—Ö–æ–¥</button>
            </div>
        </div>
    </nav>

    <div class="modal" id="login-modal">
        <div class="modal-content">
            <button class="modal-close" id="login-close">&times;</button>
            <h2 class="modal-title">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
            <form id="login-form">
                <div class="form-group"><input type="text" class="form-input" placeholder="–õ–æ–≥–∏–Ω" required id="login-username"></div>
                <div class="form-group"><input type="password" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required id="login-password"></div>
                <div class="error-message" id="login-error"></div>
                <button type="submit" class="form-submit">–í–æ–π—Ç–∏</button>
            </form>
            <div class="form-link">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="to-register-link">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –µ–≥–æ!</a></div>
        </div>
    </div>

    <div class="modal" id="register-modal">
        <div class="modal-content">
            <button class="modal-close" id="register-close">&times;</button>
            <h2 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <form id="register-form">
                <div class="form-group">
                    <label class="form-label">–ê–≤–∞—Ç–∞—Ä–∫–∞:</label>
                    <div class="avatar-upload">
                        <div class="avatar-preview" id="avatar-preview"><div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#888">–ü—Ä–µ–≤—å—é</div></div>
                        <label class="upload-button">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É<input type="file" class="upload-input" id="avatar-upload" accept=".png,.jpg,.jpeg"></label>
                    </div>
                </div>
                <div class="form-group"><input type="email" class="form-input" placeholder="Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" id="register-email"></div>
                <div class="form-group"><input type="text" class="form-input" placeholder="–õ–æ–≥–∏–Ω" required id="register-username"></div>
                <div class="form-group"><input type="password" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required id="register-password"></div>
                <div class="form-group"><input type="password" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required id="register-password-confirm"></div>
                <div class="error-message" id="register-error"></div>
                <button type="submit" class="form-submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            </form>
            <div class="form-link">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="to-login-link">–í–æ–π–¥–∏—Ç–µ!</a></div>
        </div>
    </div>

    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <button class="modal-close" id="settings-close">&times;</button>
            <h2 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
            <div class="settings-section">
                <h3 class="settings-title">–°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏</h3>
                <div class="avatar-upload">
                    <div class="avatar-preview" id="settings-avatar-preview"></div>
                    <label class="upload-button">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É<input type="file" class="upload-input" id="settings-avatar-upload" accept=".png,.jpg,.jpeg"></label>
                </div>
                <div class="success-message" id="avatar-success"></div>
            </div>
            <div class="settings-section">
                <h3 class="settings-title">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
                <form id="password-form">
                    <div class="form-group"><input type="password" class="form-input" placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å" required id="old-password"></div>
                    <div class="form-group"><input type="password" class="form-input" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required id="new-password"></div>
                    <div class="form-group"><input type="password" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required id="new-password-confirm"></div>
                    <div class="error-message" id="password-error"></div>
                    <div class="success-message" id="password-success"></div>
                    <button type="submit" class="form-submit">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </form>
            </div>
            <div class="settings-section">
                <h3 class="settings-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º</h3>
                <button class="logout-button" id="logout-btn">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            </div>
        </div>
    </div>

    <header>
        <div class="logo-container">
            <div class="logo-static"><img src="logopartstatic.png" alt="–°—Ç–∞—Ç–∏—á–Ω–∞—è —á–∞—Å—Ç—å –ª–æ–≥–æ"></div>
            <div class="logo-rotating"><img src="logopartrotation.png" alt="–í—Ä–∞—â–∞—é—â–∞—è—Å—è —á–∞—Å—Ç—å –ª–æ–≥–æ"></div>
        </div>
    </header>

    <main>
        <div class="glitch-frame">
            <h2 class="glitch-title" data-text="–û Otkazano studios">–û Otkazano studios</h2>
            <p class="glitch-text">–ú—ã - –Ω–∞—á–∏–Ω–∞—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–≥—Ä, —á—å—è —Ü–µ–ª—å –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –≤—ã–ø—É—Å–∫–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ 3D –∏–≥—Ä—ã, —Å –Ω–µ–±–æ–ª—å—à–∏–º —É–∫–ª–æ–Ω–æ–º –≤ —Ö–æ—Ä—Ä–æ—Ä, –º—ã –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ–º—Å—è –Ω–∞ –º–∞–∫—Å–∏–º—É–º –≤ –ø–æ–ø—ã—Ç–∫–∞—Ö —Å–¥–µ–ª–∞—Ç—å –Ω–∞—à –¥–µ–±—é—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç "Bendy: Down To The Inks" –∏–≥—Ä–æ–π - –¥–æ—Å—Ç–æ–π–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è, –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ –¥–∞–∂–µ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞ –Ω–∞—à–µ–π –ø–µ—Ä–≤–æ–π –∏–≥—Ä—ã! –ù–∞—à–∞ —Ü–µ–ª—å —Å—Ç–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –Ω–∞—à—É –∫–æ–º–ø–∞–Ω–∏—é –∫ —É—Å–ø–µ—Ö—É!</p>
        </div>
        <div class="glitch-frame">
            <h2 class="glitch-title" data-text="–ß–ª–µ–Ω—ã –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã">–ß–ª–µ–Ω—ã –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã</h2>
            <div class="team-container">
                <div class="team-member">
                    <div class="member-avatar"><img src="RF.png" alt="ReFinek" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><div style="width:100%;height:100%;background:#444;display:none;align-items:center;justify-content:center;color:#888">RF</div></div>
                    <div class="member-info">
                        <div class="member-name">ReFinek</div>
                        <div class="member-role">–ì–ª–∞–≤–Ω—ã–π –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</div>
                        <div class="member-description">–°–æ–∑–¥–∞–µ—Ç –≤–µ—Å—å –≤–∏–∑—É–∞–ª –≤ –∏–≥—Ä–∞—Ö, –æ—Ç –æ–±—â–µ–≥–æ –¥–∏–∑–∞–π–Ω–∞ –ø–æ–º–µ—â–µ–Ω–∏–π –¥–æ –º–∏–∫—Ä–æ–ø—ã–ª–∏–Ω–æ–∫ –≤ –∏–≥—Ä–µ, —Ç–µ–∫—Å—Ç—É—Ä—ã; 3D –º–æ–¥–µ–ª–∏; –∫–æ–Ω—Ü–µ–ø—Ç—ã; –∞–Ω–∏–º–∞—Ü–∏–∏; –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∏ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Å–∞–º–æ–º –¥–≤–∏–∂–∫–µ - –≤—Å–µ–º —ç—Ç–∏–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ–Ω, —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç –ª–æ—Ä.</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="member-avatar"><img src="SB.png" alt="SummitBadeline" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><div style="width:100%;height:100%;background:#444;display:none;align-items:center;justify-content:center;color:#888">SB</div></div>
                    <div class="member-info">
                        <div class="member-name">SummitBadeline</div>
                        <div class="member-role">–ì–ª–∞–≤–Ω—ã–π –ö–æ–¥–µ—Ä</div>
                        <div class="member-description">–ü–∏—à–µ—Ç 90% –∫–æ–¥–∞ –¥–ª—è –∏–≥—Ä, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏, –∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤, –∏ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–Ω–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–µ–º—É.</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="member-avatar"><div style="width:100%;height:100%;background:#444;display:flex;align-items:center;justify-content:center;color:#888">HG</div></div>
                    <div class="member-info">
                        <div class="member-name">HumidGolf</div>
                        <div class="member-role">–°–ø–æ–Ω—Å–æ—Ä</div>
                        <div class="member-description">–ü–æ–∫—É–ø–∞–µ—Ç –Ω–∞–º —Å—É—Ö–∞—Ä–∏–∫–∏ –∏ –ø—Ä–æ—á–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∫—É—Å–Ω—è—Ö–∏, –±–µ–∑ –Ω–µ–≥–æ –∏–≥—Ä–∞ –±—ã –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤—ã—à–ª–∞ üíÄ –∞ —Ç–∞–∫–∂–µ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–æ—Ä.</div>
                    </div>
                </div>
            </div>
            <div class="fun-text">–≠—Ç–∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ —á—É–±—Ä–∏–∫—Å—ã —Å–µ–π—á–∞—Å –∑–∞–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞—à–∏–º –ø–µ—Ä–≤—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º:)</div>
        </div>
    </main>

    <div class="scroll-to-top" id="scroll-to-top">‚Üë</div>

    <script>
        const supabaseUrl='https://kqortewzwvwfhtjqjfor.supabase.co';
        const supabaseKey='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3J0ZXd6d3Z3Zmh0anFqZm9yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MTA4MjgsImV4cCI6MjA3ODM4NjgyOH0.f4fNkeJ40VOtoto0-rIsWp4ntSjyXhtowaazcx_5v2s';
        let supabase=null,currentUser=null,avatarDataUrl=null;
        const adminUsers=['ReFinek','Admin','Root'];
        let projectsBtn,dropdown,loginBtn,authSection,loginModal,registerModal,settingsModal,loginClose,registerClose,settingsClose,loginForm,registerForm,passwordForm,toRegisterLink,toLoginLink,logoutBtn,loginError,registerError,passwordError,passwordSuccess,avatarSuccess,scrollToTop,avatarUpload,avatarPreview,settingsAvatarUpload,settingsAvatarPreview,teamMembers,adminUsersSection,usersBtn,usersDropdown,usersSearch,usersList,usersStats;

        document.addEventListener('DOMContentLoaded',()=>init());

        async function init(){
            initDOMElements();
            await initSupabase();
            checkAuthStatus();
            setupEventListeners();
        }

        async function initSupabase(){
            if(typeof supabase==='undefined'||!window.supabase)return showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö','error'),false;
            try{supabase=window.supabase.createClient(supabaseUrl,supabaseKey);return await testConnection()}catch(e){return showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö','error'),false}
        }

        function initDOMElements(){
            projectsBtn=document.getElementById('projects-btn');
            dropdown=document.getElementById('projects-dropdown');
            loginBtn=document.getElementById('login-btn');
            authSection=document.getElementById('auth-section');
            loginModal=document.getElementById('login-modal');
            registerModal=document.getElementById('register-modal');
            settingsModal=document.getElementById('settings-modal');
            loginClose=document.getElementById('login-close');
            registerClose=document.getElementById('register-close');
            settingsClose=document.getElementById('settings-close');
            loginForm=document.getElementById('login-form');
            registerForm=document.getElementById('register-form');
            passwordForm=document.getElementById('password-form');
            toRegisterLink=document.getElementById('to-register-link');
            toLoginLink=document.getElementById('to-login-link');
            logoutBtn=document.getElementById('logout-btn');
            loginError=document.getElementById('login-error');
            registerError=document.getElementById('register-error');
            passwordError=document.getElementById('password-error');
            passwordSuccess=document.getElementById('password-success');
            avatarSuccess=document.getElementById('avatar-success');
            scrollToTop=document.getElementById('scroll-to-top');
            avatarUpload=document.getElementById('avatar-upload');
            avatarPreview=document.getElementById('avatar-preview');
            settingsAvatarUpload=document.getElementById('settings-avatar-upload');
            settingsAvatarPreview=document.getElementById('settings-avatar-preview');
            teamMembers=document.querySelectorAll('.team-member');
            adminUsersSection=document.getElementById('admin-users-section');
            usersBtn=document.getElementById('users-btn');
            usersDropdown=document.getElementById('users-dropdown');
            usersSearch=document.getElementById('users-search');
            usersList=document.getElementById('users-list');
            usersStats=document.getElementById('users-stats');
        }

        async function testConnection(){
            if(!supabase)return false;
            try{const{error}=await supabase.from('users').select('username').limit(1);return!error||error.code==='PGRST116'}catch(e){return false}
        }

        function setupEventListeners(){
            if(projectsBtn&&dropdown){
                projectsBtn.addEventListener('click',e=>(e.stopPropagation(),dropdown.classList.toggle('show')));
                document.addEventListener('click',e=>{if(!dropdown.contains(e.target)&&e.target!==projectsBtn)dropdown.classList.remove('show')});
            }
            teamMembers.forEach(member=>member.addEventListener('click',()=>{
                teamMembers.forEach(m=>m!==member&&m.classList.remove('active'));
                member.classList.toggle('active');
            }));
            if(loginBtn&&loginModal)loginBtn.addEventListener('click',()=>loginModal.classList.add('show'));
            [loginClose,registerClose,settingsClose].forEach(btn=>btn&&btn.addEventListener('click',()=>{
                [loginModal,registerModal,settingsModal].forEach(m=>m&&m.classList.remove('show'));
                clearErrors();
            }));
            [loginModal,registerModal,settingsModal].forEach(modal=>modal&&modal.addEventListener('click',e=>{
                if(e.target===modal){modal.classList.remove('show');clearErrors()}
            }));
            if(toRegisterLink&&loginModal&&registerModal)toRegisterLink.addEventListener('click',e=>{
                e.preventDefault();loginModal.classList.remove('show');registerModal.classList.add('show');clearErrors();
            });
            if(toLoginLink&&registerModal&&loginModal)toLoginLink.addEventListener('click',e=>{
                e.preventDefault();registerModal.classList.remove('show');loginModal.classList.add('show');clearErrors();
            });
            if(loginForm)loginForm.addEventListener('submit',async e=>{
                e.preventDefault();
                const u=document.getElementById('login-username').value,p=document.getElementById('login-password').value;
                if(await loginUser(u,p)){loginModal.classList.remove('show');loginForm.reset();clearErrors();updateAuthUI()}else showError(loginError,'–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
            });
            if(registerForm)registerForm.addEventListener('submit',async e=>{
                e.preventDefault();
                const e=document.getElementById('register-email').value,u=document.getElementById('register-username').value,p=document.getElementById('register-password').value,pc=document.getElementById('register-password-confirm').value;
                if(p!==pc)return showError(registerError,'–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                if(u.length<3)return showError(registerError,'–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
                if(p.length<6)return showError(registerError,'–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                if(await registerUser(u,p,e,avatarDataUrl)){registerModal.classList.remove('show');registerForm.reset();clearErrors();avatarDataUrl=null;avatarPreview.innerHTML='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#888">–ü—Ä–µ–≤—å—é</div>';updateAuthUI();alert(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${u}!`)}else showError(registerError,'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
            });
            if(passwordForm)passwordForm.addEventListener('submit',async e=>{
                e.preventDefault();
                const o=document.getElementById('old-password').value,n=document.getElementById('new-password').value,nc=document.getElementById('new-password-confirm').value;
                if(n!==nc)return showError(passwordError,'–ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                if(n.length<6)return showError(passwordError,'–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                if(await changePassword(currentUser,o,n)){showSuccess(passwordSuccess,'–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');passwordForm.reset();setTimeout(()=>passwordSuccess&&passwordSuccess.classList.remove('show'),3000)}else showError(passwordError,'–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–µ–Ω');
            });
            if(logoutBtn)logoutBtn.addEventListener('click',()=>{
                if(confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')){logoutUser();settingsModal&&settingsModal.classList.remove('show')}
            });
            window.addEventListener('scroll',()=>{
                if(scrollToTop)window.pageYOffset>300?scrollToTop.classList.add('show'):scrollToTop.classList.remove('show');
            });
            if(scrollToTop)scrollToTop.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
            if(avatarUpload)avatarUpload.addEventListener('change',e=>handleAvatarUpload(e,avatarPreview));
            if(settingsAvatarUpload&&settingsAvatarPreview)settingsAvatarUpload.addEventListener('change',e=>handleAvatarUpload(e,settingsAvatarPreview,true));
            if(usersBtn&&usersDropdown){
                usersBtn.addEventListener('click',e=>(e.stopPropagation(),usersDropdown.classList.toggle('show'),usersDropdown.classList.contains('show')&&loadUsersList()));
                document.addEventListener('click',e=>{if(!usersDropdown.contains(e.target)&&e.target!==usersBtn)usersDropdown.classList.remove('show')});
                if(usersSearch)usersSearch.addEventListener('input',e=>filterUsersList(e.target.value));
            }
        }

        async function registerUser(u,p,e,a){
            if(!supabase)return showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞','error'),false;
            try{
                const{data:eu}=await supabase.from('users').select('username').eq('username',u).maybeSingle();
                if(eu)return false;
                const{error}=await supabase.from('users').insert({username:u,password:p,email:e||'',avatar:a,is_admin:adminUsers.includes(u),created_at:new Date().toISOString()}).select();
                if(error)return showNotification('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: '+error.message,'error'),false;
                localStorage.setItem('otkazano_current_user',u);currentUser=u;return true;
            }catch(e){return showNotification('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏','error'),false}
        }

        async function loginUser(u,p){
            if(!supabase)return showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞','error'),false;
            try{
                const{data:user,error}=await supabase.from('users').select('*').eq('username',u).maybeSingle();
                if(error&&error.code!=='PGRST116')return showNotification('–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: '+error.message,'error'),false;
                if(!user||user.password!==p)return false;
                localStorage.setItem('otkazano_current_user',u);currentUser=u;return true;
            }catch(e){return showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞','error'),false}
        }

        async function changePassword(u,o,n){
            if(!supabase)return showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞','error'),false;
            try{
                const{data:user}=await supabase.from('users').select('password').eq('username',u).maybeSingle();
                if(!user||user.password!==o)return false;
                const{error}=await supabase.from('users').update({password:n}).eq('username',u);
                if(error)return showNotification('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è: '+error.message,'error'),false;
                return true;
            }catch(e){return showNotification('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è','error'),false}
        }

        async function updateUserAvatar(a){
            if(!supabase)return showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞','error');
            try{
                const{error}=await supabase.from('users').update({avatar:a}).eq('username',currentUser);
                if(error)return showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏: '+error.message,'error');
                updateAuthUI();
            }catch(e){showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏','error')}
        }

        function logoutUser(){localStorage.removeItem('otkazano_current_user');currentUser=null;updateAuthUI();showNotification('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞','success')}

        async function checkAuthStatus(){
            currentUser=localStorage.getItem('otkazano_current_user');
            if(currentUser&&supabase){
                try{
                    const{data:user}=await supabase.from('users').select('username').eq('username',currentUser).maybeSingle();
                    if(!user)return logoutUser();
                }catch(e){}
            }
            updateAuthUI();
        }

        async function loadUsersList(){
            if(!usersList||!supabase)return;
            usersList.innerHTML='<div class="users-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>';
            try{
                const{data:users}=await supabase.from('users').select('*').order('created_at',{ascending:false});
                if(!users||users.length===0){usersList.innerHTML='<div class="no-users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç</div>';updateUsersStats(0);return}
                displayUsersList(users);updateUsersStats(users.length);
            }catch(e){usersList.innerHTML='<div class="no-users">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'}
        }

        function displayUsersList(u){
            if(!usersList)return;
            usersList.innerHTML='';
            u.forEach(user=>{
                const i=document.createElement('div');
                i.className=`user-list-item ${user.is_admin?'user-list-admin':''}`;
                i.innerHTML=`<div class="user-list-avatar">${user.avatar?`<img src="${user.avatar}" alt="${user.username}">`:`<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#888;font-size:12px">${user.username.charAt(0).toUpperCase()}</div>`}</div><div class="user-list-info"><div class="user-list-name">${user.username}${user.is_admin?'<span class="user-list-admin-badge">ADMIN</span>':''}</div>${user.email?`<div class="user-list-email">${user.email}</div>`:''}</div>`;
                i.addEventListener('click',()=>alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.username}\nEmail: ${user.email||'–Ω–µ —É–∫–∞–∑–∞–Ω'}\n–ê–¥–º–∏–Ω: ${user.is_admin?'–î–∞':'–ù–µ—Ç'}\n–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(user.created_at).toLocaleDateString()}`));
                usersList.appendChild(i);
            });
        }

        function filterUsersList(s){
            if(!usersList)return;
            const i=usersList.querySelectorAll('.user-list-item');let v=0;
            i.forEach(item=>{
                const u=item.querySelector('.user-list-name').textContent.toLowerCase(),e=item.querySelector('.user-list-email')?.textContent.toLowerCase()||'';
                if(u.includes(s.toLowerCase())||e.includes(s.toLowerCase())){item.style.display='flex';v++}else item.style.display='none';
            });
            if(v===0&&s)usersList.innerHTML='<div class="no-users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
        }

        function updateUsersStats(t){if(usersStats)usersStats.innerHTML=`–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${t}`}

        function handleAvatarUpload(e,p,s=false){
            const f=e.target.files[0];
            if(!f)return;
            if(!f.type.match('image/png')&&!f.type.match('image/jpeg'))return alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ PNG, JPG –∏–ª–∏ JPEG');
            if(f.size>2*1024*1024)return alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 2MB');
            const r=new FileReader();
            r.onload=function(e){
                const i=new Image();
                i.onload=function(){
                    const c=document.createElement('canvas'),s=Math.min(i.width,i.height);
                    c.width=s;c.height=s;
                    const x=c.getContext('2d');
                    x.drawImage(i,(i.width-s)/2,(i.height-s)/2,s,s,0,0,s,s);
                    const cc=document.createElement('canvas');
                    cc.width=s;cc.height=s;
                    const xc=cc.getContext('2d');
                    xc.beginPath();xc.arc(s/2,s/2,s/2,0,2*Math.PI);xc.closePath();xc.clip();
                    xc.drawImage(c,0,0,s,s);
                    const d=cc.toDataURL('image/png');
                    if(s){updateUserAvatar(d);showSuccess(avatarSuccess,'–ê–≤–∞—Ç–∞—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');setTimeout(()=>avatarSuccess&&avatarSuccess.classList.remove('show'),3000)}else avatarDataUrl=d;
                    if(p){p.innerHTML='';const i=document.createElement('img');i.src=d;p.appendChild(i)}
                };
                i.src=e.target.result;
            };
            r.readAsDataURL(f);
        }

        async function updateAuthUI(){
            if(!authSection)return;
            if(currentUser){
                try{
                    let u=null;
                    if(supabase){
                        const{data}=await supabase.from('users').select('*').eq('username',currentUser).maybeSingle();
                        u=data;
                    }
                    if(!u)return logoutUser();
                    const a=u.is_admin?'<div class="admin-badge">–ì–ª–∞–≤–Ω—ã–π –ø–∞–ø–æ—á–∫–∞</div>':'';
                    if(adminUsersSection)adminUsersSection.style.display=u.is_admin?'block':'none';
                    authSection.innerHTML=`<div class="user-container"><div class="user-profile" id="user-profile"><div class="user-avatar">${u.avatar?`<img src="${u.avatar}" alt="${currentUser}">`:`<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#888">${currentUser.charAt(0)}</div>`}</div><div class="username">${currentUser}</div></div>${a}</div>`;
                    if(settingsAvatarPreview)settingsAvatarPreview.innerHTML=u.avatar?`<img src="${u.avatar}" alt="${currentUser}">`:`<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#888">${currentUser.charAt(0)}</div>`;
                    const p=document.getElementById('user-profile');
                    if(p&&settingsModal)p.addEventListener('click',()=>settingsModal.classList.add('show'));
                }catch(e){showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è','error')}
            }else{
                if(adminUsersSection)adminUsersSection.style.display='none';
                authSection.innerHTML='<button class="nav-button login-button" id="login-btn">–í—Ö–æ–¥</button>';
                const b=document.getElementById('login-btn');
                if(b&&loginModal)b.addEventListener('click',()=>loginModal.classList.add('show'));
            }
        }

        function showError(e,m){if(e){e.textContent=m;e.classList.add('show')}}
        function showSuccess(e,m){if(e){e.textContent=m;e.classList.add('show')}}
        function clearErrors(){[loginError,registerError,passwordError,passwordSuccess,avatarSuccess].forEach(e=>e&&e.classList.remove('show'))}
        function showNotification(m,t){const n=document.createElement('div');n.style.cssText=`position:fixed;top:20px;right:20px;background:${t==='success'?'#4f4':'#f44'};color:white;padding:15px;border-radius:8px;z-index:10000;max-width:300px;box-shadow:0 4px 12px rgba(0,0,0,0.3)`;n.textContent=m;document.body.appendChild(n);setTimeout(()=>n.remove(),t==='success'?3000:5000)}
    </script>
</body>
</html>
